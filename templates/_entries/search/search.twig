{# @param entry Entry injected by Craft routing #}

{% extends '_layouts/main.twig' %}

{# Request wide layout #}
{% set layoutMaxWidth = 'lg' %}

{# Get param from url, will be null if not present #}
{% set searchQuery = craft.app.request.getParam('q') %}

{% block content %}
    {# The search form #}
    {# mobile (< md): stack vertically, with a bit of y margins #}
    {# desktop (> md): show horizontally, with a bit of x margins #}
    <form
        class="border-brand-300 space-y-4 border bg-white p-4 shadow-md md:flex md:items-center md:space-y-0 md:space-x-4"
    >
        <label
            class="mb-1 block font-bold whitespace-nowrap text-gray-500 md:mb-0 md:text-right"
            for="search-query"
        >
            {{ 'Search for:'|t }}
        </label>

        {# Input is styled by Tailwind forms plugin #}
        <input
            type="search"
            id="search-query"
            autofocus
            class="w-full"
            name="q"
            value="{{ searchQuery }}"
        />

        {% include '_partials/submitButton.twig' with { caption: 'Start'|t } only %}
    </form>

    {% if searchQuery %}
        {# The search query #}
        {% set query = craft.entries().section('article').search(searchQuery).orderBy('score') %}

        {# This is actually a duplicate query, as we need the count beforehand. #}
        {% set count = query.count %}

        {% if count %}
            {# Use a singular/plural aware translation rule #}
            <h2 class="mt-8 text-xl">
                {{ count }}
                {{ '{count,plural,=1{search result} other{search results}}'|t({ count: count }) }}
            </h2>

            {# Reuse the cards layout from article listing #}
            {% include '_entries/article/partials/article-cards.twig' with {
                query,
                perPage: 12
            } only %}
        {% else %}
            <div class="mt-4">
                {{
                    'Your search for "{q}" didnâ€™t return any results.'|t({
                        q: searchQuery,
                        count: count
                    })
                }}
            </div>
        {% endif %}
    {% endif %}
{% endblock content %}
